<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Home Assistant on 电子荒原</title>
    <link>http://localhost:1313/tags/home-assistant/</link>
    <description>Recent content in Home Assistant on 电子荒原</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>zh-cn</language>
    <copyright>&amp;copy;召唤兽，&lt;a href=&#34;https://creativecommons.org/licenses/by-nc/4.0/&#34;&gt;CC BY-NC 4.0&lt;/a&gt;</copyright>
    <lastBuildDate>Sun, 05 May 2024 15:30:35 +0800</lastBuildDate>
    
	<atom:link href="http://localhost:1313/tags/home-assistant/feed.xml" rel="self" type="application/rss+xml" />
    
    
    <item>
      <title>“智能” 家居笔记：一年后的回顾</title>
      <link>http://localhost:1313/2024/05/05/silly-home-notes-review/</link>
      <pubDate>Sun, 05 May 2024 15:30:35 +0800</pubDate>
      
      <guid>http://localhost:1313/2024/05/05/silly-home-notes-review/</guid>
      <description></description>
    </item>
    
    <item>
      <title>一些矿渣的耗电量</title>
      <link>http://localhost:1313/2023/08/10/energy-cost/</link>
      <pubDate>Thu, 10 Aug 2023 20:35:54 +0800</pubDate>
      
      <guid>http://localhost:1313/2023/08/10/energy-cost/</guid>
      <description>&lt;p&gt;最近在小黄鱼上淘到一个支持电量统计的插排（&lt;a href=&#34;https://post.smzdm.com/p/a304w8vk/p3/?sort_tab=hot/#comments&#34;&gt;这个&lt;/a&gt;），卖家还贴心地刷好了ESPHome固件。&lt;/p&gt;
&lt;figure&gt;&lt;img src=&#34;http://localhost:1313/2023/08/10/energy-cost/figure.png&#34;&gt;&lt;figcaption&gt;
      &lt;h4&gt;数据就不标了，有兴趣的可以自行使用Engauge Digitizer&lt;/h4&gt;
    &lt;/figcaption&gt;
&lt;/figure&gt;
&lt;p&gt;于是我用Excel算好了：&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;/th&gt;
&lt;th&gt;功率/W&lt;/th&gt;
&lt;th&gt;年功耗/kWh&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;插座&lt;/td&gt;
&lt;td&gt;3.8&lt;/td&gt;
&lt;td&gt;33.288&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;我家云&lt;/td&gt;
&lt;td&gt;5.4&lt;/td&gt;
&lt;td&gt;47.304&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;锐角云&lt;/td&gt;
&lt;td&gt;4.7&lt;/td&gt;
&lt;td&gt;41.172&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;蜗牛星际&lt;/td&gt;
&lt;td&gt;40.8&lt;/td&gt;
&lt;td&gt;357.408&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;ul&gt;
&lt;li&gt;首先是这个插排，本身待机就有3.8W，离谱。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;锐角云&lt;/code&gt;开启之后总电量为8.9W，本身耗电4.7W。锐角云的配置是N3450、8GB内存，上面插了一块256G的SATA SSD，运行PVE、Home Assistant和另外2个虚拟机，直插12V电源适配器把待机功耗控制在极低的水平。&lt;/li&gt;
&lt;li&gt;9.6W的部分是&lt;code&gt;我家云&lt;/code&gt;的贡献。孱弱的RK3328核心，捉襟见肘的2G内存，即使再加上一块500G的2.5寸机械硬盘，耗电量也仅为5.4W，作为小型文件服务器可以直接忘掉电费问题。&lt;/li&gt;
&lt;li&gt;而&lt;code&gt;蜗牛星际&lt;/code&gt;就可以算上电老虎了。1块老旧SSD，两块老旧2.5寸和一块8T海淘盘带来了&lt;strong&gt;高达&lt;/strong&gt;40.8W的耗电，如果24小时开机的话每年会带来&lt;strong&gt;高达&lt;/strong&gt;一百多块的账单。&lt;/li&gt;
&lt;/ul&gt;
&lt;figure&gt;&lt;img src=&#34;http://localhost:1313/2023/08/10/energy-cost/%E4%BB%8A%E5%B9%B4.png&#34; width=&#34;50%&#34;&gt;&lt;figcaption&gt;
      &lt;h4&gt;顺便一提，我家今年的耗电量长这样。这才仅仅是8月而已……&lt;/h4&gt;
    &lt;/figcaption&gt;
&lt;/figure&gt;
&lt;p&gt;OK，当我今天没有更新过。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>“智能”家居笔记，其之二</title>
      <link>http://localhost:1313/2023/03/08/silly-home-notes-detailed/</link>
      <pubDate>Wed, 08 Mar 2023 21:32:06 +0800</pubDate>
      
      <guid>http://localhost:1313/2023/03/08/silly-home-notes-detailed/</guid>
      <description>&lt;p&gt;书接&lt;a href=&#34;http://localhost:1313/2023/02/10/silly-home-notes-1/&#34;&gt;上文&lt;/a&gt;。说起来，智能家居的可复制性在软件领域里是比较差的，在完成基础的环境搭建之后，功能需求要根据自己的实际情况来决定，以下的所有内容仅供抛砖引玉之用。&lt;/p&gt;
&lt;h2 id=&#34;前端显示&#34;&gt;前端显示&lt;/h2&gt;
&lt;p&gt;隆重推荐&lt;a href=&#34;https://github.com/dwainscheeren/dwains-lovelace-dashboard&#34;&gt;Dwains dashboard&lt;/a&gt;，这是在HA生态系统下仅有的不怎么需要折腾的部分。只需要把每个设备的&lt;em&gt;区域&lt;/em&gt;选好，就可以得到一组还不错的面板：&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;dwains.png&#34; alt=&#34;Dwains dashboard&#34;&gt;&lt;/p&gt;
&lt;p&gt;而&lt;a href=&#34;https://experiencelovelace.github.io/ha-floorplan/&#34;&gt;Floorplan&lt;/a&gt;是另一个极端，这个组件需要很久——非常久——才能够完成，而完成之后也只有无尽的空虚。为了缓解这空虚我也姑且把截图放在这里。&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;floorplan.png&#34; alt=&#34;Floorplan&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;手机消息提醒&#34;&gt;手机消息提醒&lt;/h2&gt;
&lt;p&gt;作为没有统一推送服务的安卓用户，加入新的后台程序无异于火上浇油，所以最经济的方法是投靠大流氓微信。之前互联网上常见的方法是&lt;a href=&#34;https://www.jianshu.com/p/182ea14af3f2&#34;&gt;企业微信发送应用消息&lt;/a&gt;，不过到了2023年，这种方式需要绑定固定IP和域名，所以我换成了&lt;a href=&#34;https://www.pushplus.plus/doc/extend/webhook.html#%E5%BC%95%E8%A8%80&#34;&gt;企业微信机器人&lt;/a&gt;。这种方法需要有一个微信群（两人以上），对单身贵族不是十分友好。&lt;/p&gt;
&lt;p&gt;在获得Webhook地址之后，在HA配置文件中添加以下行：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#09f;font-style:italic&#34;&gt;# configuration.yaml&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#bbb&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#309;font-weight:bold&#34;&gt;rest_command&lt;/span&gt;:&lt;span style=&#34;color:#bbb&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#bbb&#34;&gt;  &lt;/span&gt;&lt;span style=&#34;color:#309;font-weight:bold&#34;&gt;wechat_message&lt;/span&gt;:&lt;span style=&#34;color:#bbb&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#bbb&#34;&gt;      &lt;/span&gt;&lt;span style=&#34;color:#309;font-weight:bold&#34;&gt;url&lt;/span&gt;:&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#c30&#34;&gt;&amp;#34;https://qyapi.weixin.qq.com/cgi-bin/webhook/send?key=略&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#bbb&#34;&gt;      &lt;/span&gt;&lt;span style=&#34;color:#309;font-weight:bold&#34;&gt;method&lt;/span&gt;:&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;post&lt;span style=&#34;color:#bbb&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#bbb&#34;&gt;      &lt;/span&gt;&lt;span style=&#34;color:#309;font-weight:bold&#34;&gt;content_type&lt;/span&gt;:&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#c30&#34;&gt;&amp;#39;application/json&amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#bbb&#34;&gt;      &lt;/span&gt;&lt;span style=&#34;color:#309;font-weight:bold&#34;&gt;payload&lt;/span&gt;:&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#c30&#34;&gt;&amp;#39;{&amp;#34;msgtype&amp;#34;:&amp;#34;text&amp;#34;,&amp;#34;text&amp;#34;:{&amp;#34;content&amp;#34;:&amp;#34;{{  message  }}&amp;#34;}}&amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;就可以在自动化中&lt;code&gt;Call a service&lt;/code&gt;，调用&lt;code&gt;wechat_message&lt;/code&gt;了。&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;rest_command.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;另外，可以试试&lt;a href=&#34;https://blog.star7th.com/2022/03/2421.html&#34;&gt;showdoc推送服务&lt;/a&gt;。我没用过，不对这个负责。&lt;/p&gt;
&lt;p&gt;或者直接想办法给微信绑定的QQ邮箱发信，反正他们信用卡诈骗邮件都是这么干的。&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;QQmail.png&#34; alt=&#34;推送的非常及时&#34;&gt;&lt;/p&gt;
&lt;p&gt;或者直接用Home Assistant自带的&lt;a href=&#34;https://www.home-assistant.io/integrations/html5&#34;&gt;HTML5 Push Notifications&lt;/a&gt;；或者TG机器人；或者自建&lt;a href=&#34;https://ntfy.sh/&#34;&gt;ntfy.sh&lt;/a&gt;——反正都很复杂。&lt;/p&gt;
&lt;h2 id=&#34;开关其他计算机&#34;&gt;开关其他计算机&lt;/h2&gt;
&lt;p&gt;当前，因为不想和国家电网签约，我在平时保持台式机和NAS处于关闭状态，只在需要时通过HA所在的矿渣来&lt;a href=&#34;https://www.home-assistant.io/integrations/wake_on_lan/&#34;&gt;Wake on LAN&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;开机问题解决了，关闭需要另外的解决方式。对于Windows系统，可以使用&lt;a href=&#34;https://gitlab.com/iotlink/iotlink/-/wikis/Addons/Commands&#34;&gt;IOT Link&lt;/a&gt;；而对于更常用的Linux系统，可以使用SSH来运行shutdown。仍然是HA配置文件：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#09f;font-style:italic&#34;&gt;#configuration.yaml&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#bbb&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#309;font-weight:bold&#34;&gt;switch&lt;/span&gt;:&lt;span style=&#34;color:#bbb&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#bbb&#34;&gt;  &lt;/span&gt;- &lt;span style=&#34;color:#309;font-weight:bold&#34;&gt;platform&lt;/span&gt;:&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;wake_on_lan&lt;span style=&#34;color:#bbb&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#bbb&#34;&gt;    &lt;/span&gt;&lt;span style=&#34;color:#309;font-weight:bold&#34;&gt;name&lt;/span&gt;:&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;Trashbin&lt;span style=&#34;color:#bbb&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#bbb&#34;&gt;    &lt;/span&gt;&lt;span style=&#34;color:#309;font-weight:bold&#34;&gt;mac&lt;/span&gt;:&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#f60&#34;&gt;00&lt;/span&gt;:&lt;span style=&#34;color:#f60&#34;&gt;00&lt;/span&gt;:&lt;span style=&#34;color:#f60&#34;&gt;00&lt;/span&gt;:&lt;span style=&#34;color:#f60&#34;&gt;00&lt;/span&gt;:&lt;span style=&#34;color:#f60&#34;&gt;00&lt;/span&gt;:&lt;span style=&#34;color:#f60&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#bbb&#34;&gt;    &lt;/span&gt;&lt;span style=&#34;color:#309;font-weight:bold&#34;&gt;host&lt;/span&gt;:&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#f60&#34;&gt;192.168.8.88&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#09f;font-style:italic&#34;&gt;#用ping来检测是否已开机&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#bbb&#34;&gt;    &lt;/span&gt;&lt;span style=&#34;color:#309;font-weight:bold&#34;&gt;turn_off&lt;/span&gt;:&lt;span style=&#34;color:#bbb&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#bbb&#34;&gt;      &lt;/span&gt;&lt;span style=&#34;color:#309;font-weight:bold&#34;&gt;service&lt;/span&gt;:&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;shell_command.turn_off_trashbin&lt;span style=&#34;color:#bbb&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#bbb&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#309;font-weight:bold&#34;&gt;shell_command&lt;/span&gt;:&lt;span style=&#34;color:#bbb&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#bbb&#34;&gt;  &lt;/span&gt;&lt;span style=&#34;color:#309;font-weight:bold&#34;&gt;turn_off_trashbin&lt;/span&gt;:&lt;span style=&#34;color:#bbb&#34;&gt;  &lt;/span&gt;&lt;span style=&#34;color:#c30&#34;&gt;&amp;#34;ssh -i /config/ssh_keys/id_rsa_homeassistant -o &amp;#39;StrictHostKeyChecking=no&amp;#39; user@192.168.8.88 &amp;#39;sudo /usr/bin/systemctl poweroff&amp;#39;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;别忘了把私钥放在&lt;code&gt;/config/ssh_keys/id_rsa_homeassistant&lt;/code&gt;，并上传公钥。在&lt;code&gt;authorized_keys&lt;/code&gt;中动些手脚，可以&lt;a href=&#34;https://www.virtono.com/community/tutorial-how-to/restrict-executable-ssh-commands-with-authorized-keys/&#34;&gt;限制SSH允许执行的命令&lt;/a&gt;。另外，需要设置sudo在运行poweroff时不需要密码。&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#09f;font-style:italic&#34;&gt;## sudo visudo&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;%sudo   &lt;span style=&#34;color:#033&#34;&gt;ALL&lt;/span&gt;&lt;span style=&#34;color:#555&#34;&gt;=(&lt;/span&gt;ALL&lt;span style=&#34;color:#555&#34;&gt;)&lt;/span&gt; NOPASSWD: /usr/bin/systemctl poweroff
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;远程访问&#34;&gt;远程访问&lt;/h2&gt;
&lt;p&gt;&lt;a href=&#34;http://localhost:1313/2023/02/07/beyond-nat-2023/&#34;&gt;之前这篇文章&lt;/a&gt;就是为了这个。&lt;/p&gt;
&lt;h2 id=&#34;在家检测&#34;&gt;在家检测&lt;/h2&gt;
&lt;p&gt;又名device tracker，与路由器有关，我用了&lt;a href=&#34;https://www.home-assistant.io/integrations/luci/&#34;&gt;OpenWrt (luci)&lt;/a&gt;集成。独居的话，&lt;a href=&#34;https://github.com/AlexxIT/XiaomiGateway3/wiki/Handle-BLE-Locks&#34;&gt;BLE门锁&lt;/a&gt;也能完成类似的工作。控制欲更强的朋友可以尝试&lt;a href=&#34;https://github.com/ESPresense/ESPresense&#34;&gt;ESPresense&lt;/a&gt;，应该是能到房间级别。&lt;/p&gt;
&lt;h2 id=&#34;零冷水&#34;&gt;零冷水&lt;/h2&gt;
&lt;p&gt;如果你像我家一样，燃气热水器/壁挂炉离浴室太远，需要一套零冷水系统，那么首先需要把回水管留好。然后……最好能搞点&lt;a href=&#34;https://www.xiaomiyoupin.com/detail?gid=152447&#34;&gt;成品系统&lt;/a&gt;，不要像我一样用&lt;a href=&#34;https://item.taobao.com/item.htm?spm=a1z09.2.0.0.ef352e8dz7aUZB&#34;&gt;屏蔽泵&lt;/a&gt;和智能开关解决，毕竟这玩意还是有一定难度的。
&lt;figure&gt;&lt;img src=&#34;http://localhost:1313/2023/03/08/silly-home-notes-detailed/pump.jpg&#34;
    alt=&#34;设计水路和买接头全要靠自己了。&#34;&gt;&lt;figcaption&gt;
      &lt;p&gt;设计水路和买接头全要靠自己了。&lt;/p&gt;
    &lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;弄完之后，把水泵插在智能插座上，在卫生间安装人体传感器，每当卫生间有人经过的时候就运行半小时。&lt;/p&gt;
&lt;p&gt;没有预留回水管的话可以参考&lt;a href=&#34;https://post.smzdm.com/p/a9g2nm9o/&#34;&gt;这里&lt;/a&gt;。&lt;/p&gt;
&lt;h2 id=&#34;自适应照明&#34;&gt;自适应照明&lt;/h2&gt;
&lt;p&gt;……&lt;a href=&#34;https://post.smzdm.com/p/a8x5xqpl/&#34;&gt;感觉很高级&lt;/a&gt;，没了。&lt;/p&gt;
&lt;h2 id=&#34;监控摄像&#34;&gt;监控摄像&lt;/h2&gt;
&lt;p&gt;为了照料人类幼崽，我买了3个摄像头，是广受好评的TP-link系列&lt;sup id=&#34;fnref:1&#34;&gt;&lt;a href=&#34;#fn:1&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;1&lt;/a&gt;&lt;/sup&gt;，ONVIF协议除了端口是&lt;code&gt;:2020&lt;/code&gt;之外和标准一模一样，也自然支持HA的&lt;a href=&#34;https://www.home-assistant.io/integrations/onvif/&#34;&gt;ONVIF&lt;/a&gt;集成。&lt;/p&gt;
&lt;p&gt;因为正好有一台杂牌NAS，硬盘录像机的钱可以省掉了。NVR软件方面，我尝试了&lt;code&gt;Shinobi.video&lt;/code&gt;&lt;sup id=&#34;fnref:2&#34;&gt;&lt;a href=&#34;#fn:2&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;2&lt;/a&gt;&lt;/sup&gt;和&lt;code&gt;motioneye&lt;/code&gt;&lt;sup id=&#34;fnref:3&#34;&gt;&lt;a href=&#34;#fn:3&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;3&lt;/a&gt;&lt;/sup&gt;，最后选了iSpy公司的&lt;a href=&#34;https://www.ispyconnect.com/download.aspx&#34;&gt;Agent DVR&lt;/a&gt;，设置最简单，也具有最完善的HA集成，抱歉啦开源社区。&lt;/p&gt;
&lt;h2 id=&#34;附当前用到的自动化&#34;&gt;附：当前用到的自动化&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;按下开关 -&amp;gt; 关掉对应的灯
&lt;blockquote&gt;
&lt;p&gt;每个灯都要做一次，很无聊。但是设置完之后，每个灯都能缓缓熄灭，就……挺高级的。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/li&gt;
&lt;li&gt;开关窗帘
&lt;ul&gt;
&lt;li&gt;在每天晚上8:00自动关闭所有窗帘&lt;/li&gt;
&lt;li&gt;我在家的情况下，当我的下一个闹钟响起时，打开主卧窗帘&lt;/li&gt;
&lt;li&gt;早上8:30打开所有窗帘&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;浴室门
&lt;ul&gt;
&lt;li&gt;浴室门关闭 -&amp;gt; 打开照明、打开循环泵&lt;/li&gt;
&lt;li&gt;浴室门开启 -&amp;gt; 关闭照明、关闭浴霸制热、等待十分钟 -&amp;gt; 关闭浴霸通风&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;防盗门
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/AlexxIT/XiaomiGateway3/wiki/Handle-BLE-Locks&#34;&gt;门从外部被打开&lt;/a&gt; -&amp;gt; 打开门厅灯、打开循环水，如果在8:00-22:00间，小爱播报“欢迎回家”。
&lt;blockquote&gt;
&lt;p&gt;就……挺高级的……吧……&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;循环泵
&lt;ul&gt;
&lt;li&gt;每天午夜关闭循环泵&lt;/li&gt;
&lt;li&gt;开启30分钟后关闭循环泵&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;在电费余额不足时，向企业微信发送信息&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;暂时我还没搞懂&lt;code&gt;NodeRED&lt;/code&gt;是干什么用的，看起来&lt;a href=&#34;https://community.home-assistant.io/t/pyscript-new-integration-for-easy-and-powerful-python-scripting&#34;&gt;pyscript&lt;/a&gt;还更有趣一些。&lt;/p&gt;
&lt;h3 id=&#34;heading&#34;&gt;&lt;/h3&gt;
&lt;div class=&#34;footnotes&#34; role=&#34;doc-endnotes&#34;&gt;
&lt;hr&gt;
&lt;ol&gt;
&lt;li id=&#34;fn:1&#34;&gt;
&lt;p&gt;型号是TL-IPC44AW Pro，那个Pro让它多了5G wifi支持。&amp;#160;&lt;a href=&#34;#fnref:1&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&#34;fn:2&#34;&gt;
&lt;p&gt;不太支持H.265格式的录制，实时播放老有问题，而且没搞懂HA集成怎么用。&amp;#160;&lt;a href=&#34;#fnref:2&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&#34;fn:3&#34;&gt;
&lt;p&gt;这个我没仔细试，祝你成功！&amp;#160;&lt;a href=&#34;#fnref:3&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;
</description>
    </item>
    
    <item>
      <title>“智能”家居笔记，其之三</title>
      <link>http://localhost:1313/2023/02/13/silly-home-notes-3/</link>
      <pubDate>Mon, 13 Feb 2023 21:32:06 +0800</pubDate>
      
      <guid>http://localhost:1313/2023/02/13/silly-home-notes-3/</guid>
      <description>&lt;p&gt;ESPHome&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;esp.svg&#34; alt=&#34;esp&#34;&gt;&lt;/p&gt;
&lt;p&gt;漂亮的传感器&lt;/p&gt;
&lt;p&gt;电表&lt;/p&gt;
&lt;p&gt;TODO：门禁继电器&lt;/p&gt;
&lt;p&gt;TODO：激光测距、雷达&lt;/p&gt;
&lt;p&gt;TODO：壁挂炉控温&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>“智能”家居笔记，其之一</title>
      <link>http://localhost:1313/2023/02/10/silly-home-notes-1/</link>
      <pubDate>Fri, 10 Feb 2023 20:44:06 +0800</pubDate>
      
      <guid>http://localhost:1313/2023/02/10/silly-home-notes-1/</guid>
      <description>&lt;blockquote&gt;
&lt;p&gt;而RK3328的算力与草履虫大约能打成平手。所以，本文中的“智能”指的都是 &lt;em&gt;不用按电钮就能控制™&lt;/em&gt; 级别，当然，如果能够有一点点自动就更好了。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;前期的准备&#34;&gt;前期的准备&lt;/h2&gt;
&lt;h3 id=&#34;考虑一下&#34;&gt;考虑一下&lt;/h3&gt;
&lt;p&gt;其实当个mi boy也不错——全屋小米设备是智能家居方案里面最不坏的选择，做完就可以成为合格的家居up主了&lt;sup id=&#34;fnref:1&#34;&gt;&lt;a href=&#34;#fn:1&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;1&lt;/a&gt;&lt;/sup&gt;。不过，如果不想被锁定在米系势力范围内，可以尝试一下Home Assistant，尝试成本也不高：几十块钱的魔百盒或者玩客云，或者直接虚拟机都可以。另外，最好能有一个简单的设备来控制，我觉得带红外遥控的小爱音箱 Pro就挺好的。&lt;/p&gt;
&lt;h3 id=&#34;装修时&#34;&gt;装修时&lt;/h3&gt;
&lt;p&gt;当然是老生常谈的那些：在开关里面留零线、不要做双控（贵）、多做网线口、窗帘盒旁边做插座之类的，剩下的事情只能等到装完以后再后悔了。&lt;/p&gt;
&lt;p&gt;就我来说，我比较后悔没有给拖地机器人留上下水的位置，没有把净水器的纯水管引到客厅，也没有留两个给摄像头和人体存在传感器的插座。&lt;/p&gt;
&lt;h2 id=&#34;新手的采购清单&#34;&gt;新手的采购清单&lt;/h2&gt;
&lt;p&gt;最好能够遵循 &lt;em&gt;Graceful degradation&lt;/em&gt; 原则：保证有东西坏掉的时候至少还是个mi boy，然后就可以把所有问题推到米家服务器身上了。另一方面，如果要在熟练后彻底摆脱米家的控制，需要寻找那些离线仍然可以通过HA控制的设备，也就是说，最好不要选择米家&lt;del&gt;臭名昭著的&lt;/del&gt;最新的BLE Mesh系列。那么，在2022年，我的选择是大量的Zigbee设备、少量的Wifi设备和更少的蓝牙设备。Nothing Matter.&lt;/p&gt;
&lt;details&gt;
&lt;summary&gt;
  &lt;h4 class=&#34;inline&#34;&gt;
    下面是米系智能设备的列表，截至2022年。盛惠5527元。
  &lt;/h4&gt;
&lt;/summary&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;设备&lt;/th&gt;
&lt;th&gt;数量&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;墙壁开关E1（零火双键）&lt;/td&gt;
&lt;td&gt;10&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Aqara双色温LED灯泡T1&lt;/td&gt;
&lt;td&gt;6&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Aqara智能墙壁插座Zigbee&lt;/td&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Aqara水浸传感器&lt;/td&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Aqara人体传感器&lt;/td&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Aqara门窗传感器&lt;/td&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Aqara温湿度传感器&lt;/td&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;yeelight m3筒灯（BLE）&lt;/td&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;米家第三方壁灯（BLE）&lt;/td&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;米家客厅吸顶灯&lt;/td&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;米家卧室吸顶灯450&lt;/td&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;米家卧室吸顶灯350&lt;/td&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;杜亚M2米家款电机（Aqara的买不起）&lt;/td&gt;
&lt;td&gt;3&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;门锁1s（BLE）&lt;/td&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;小米多模网关&lt;/td&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;/details&gt;
&lt;p&gt;Aqara在闲鱼买会显得不那么冤大头，杜亚牌电机也比杜亚代工的Aqara电机便宜很多。家电方面，美的和其副牌（小天鹅、华凌、colmo之类）一般自带网络功能，通过插件&lt;a href=&#34;https://github.com/georgezhao2010/midea_ac_lan&#34;&gt;midea_ac_lan&lt;/a&gt;和HA配合的很不错。&lt;/p&gt;
&lt;figure&gt;&lt;img src=&#34;http://localhost:1313/2023/02/10/silly-home-notes-1/midea.png&#34;
    alt=&#34;美的营销号矩阵&#34;&gt;&lt;figcaption&gt;
      &lt;p&gt;美的营销号矩阵&lt;/p&gt;
    &lt;/figcaption&gt;
&lt;/figure&gt;

&lt;p&gt;对了，还需要一台能够24小时开机的设备，比如NAS啊、矿渣啊什么的。&lt;/p&gt;
&lt;h2 id=&#34;安装和设置&#34;&gt;安装和设置&lt;/h2&gt;
&lt;p&gt;安装HA的部分在此不再赘述。通过米家APP配置以上的所有设备，并使用&lt;a href=&#34;https://github.com/al-one/hass-xiaomi-miot&#34;&gt;hass-xiaomi-miot&lt;/a&gt;和&lt;a href=&#34;https://github.com/AlexxIT/XiaomiGateway3#supported-firmwares&#34;&gt;XiaomiGateway3&lt;/a&gt;导入HA。这里需要注意的是，&lt;code&gt;hass-xiaomi-miot&lt;/code&gt;集成只能对WiFi设备进行本地控制，对Zigbee和BLE设备&lt;a href=&#34;https://github.com/al-one/hass-xiaomi-miot/issues/100#issuecomment-855183156&#34;&gt;需要通过米家服务器&lt;/a&gt;。所以最好由&lt;code&gt;gateway3&lt;/code&gt;控制这些设备，在&lt;code&gt;hass-xiaomi-miot&lt;/code&gt;集成中禁用。&lt;/p&gt;
&lt;p&gt;考虑到安装非智能灯的可能性，我采用了&lt;code&gt;智能开关+智能灯&lt;/code&gt;的组合，这种组合更为保守，&lt;code&gt;凌动开关+支持凌动的智能灯&lt;/code&gt;效果大概会更好。在把所有智能灯配置完成后，在米家APP上把链接智能灯的开关&lt;code&gt;转为无线开关&lt;/code&gt;，然后在HA中设置自动化，感觉比米家自动化的反应更灵敏一些。不过，为了防止在HA断掉时挨骂，我也在米家APP上添加了备份：在同时按下开关左右键的时候关闭智能灯。&lt;/p&gt;
&lt;figure&gt;&lt;img src=&#34;http://localhost:1313/2023/02/10/silly-home-notes-1/double-auto.jpg&#34;
    alt=&#34;HA和米家设置自动化&#34;&gt;&lt;figcaption&gt;
      &lt;p&gt;HA和米家设置自动化&lt;/p&gt;
    &lt;/figcaption&gt;
&lt;/figure&gt;

&lt;p&gt;这样，在关闭智能灯的时候不会断电，可以实现灯光缓灭、&lt;a href=&#34;https://github.com/basnijholt/adaptive-lighting&#34;&gt;自适应照明&lt;/a&gt;等高级功能。&lt;/p&gt;
&lt;p&gt;窗帘的部分就更简单了，只要定时开关就行。通过HA的手机APP，可以将&lt;a href=&#34;https://companion.home-assistant.io/docs/core/sensors/#next-alarm-sensor&#34;&gt;下一个闹钟时间&lt;/a&gt;导入自动化，实现闹铃响起时打开窗帘。&lt;/p&gt;
&lt;h2 id=&#34;附加题部分&#34;&gt;附加题部分&lt;/h2&gt;
&lt;p&gt;在基本框架（aka灯和窗帘）搭好之后，就可以放飞自我搞一些新花样，这里举两个例子。&lt;/p&gt;
&lt;h3 id=&#34;智能面板&#34;&gt;智能面板&lt;/h3&gt;
&lt;p&gt;&lt;a href=&#34;https://detail.1688.com/offer/662976153559.html?spm=a26352.13672862.offerlist.49.3a512910uzdgfQ&#34;&gt;Sonoff NSPanel&lt;/a&gt;应该是最便宜的智能面板了，而且可以刷第三方固件&lt;a href=&#34;https://github.com/joBr99/nspanel-lovelace-ui&#34;&gt;lovelace-ui&lt;/a&gt;或&lt;a href=&#34;https://github.com/Blackymas/NSPanel_HA_Blueprint&#34;&gt;NSPanel_HA_Blueprint&lt;/a&gt;，可玩性非常高。&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;nspanel-rl.png&#34; alt=&#34;NSPanel Lovelace UI&#34;&gt;&lt;/p&gt;
&lt;p&gt;如果需要更大的屏幕，甚至可以在仓库里找一些淘汰的设备，比如说还能亮的山寨平板、二手安卓手机、闲鱼低价带屏开发板之类。通过&lt;a href=&#34;https://wallpanel.xyz/&#34;&gt;WallPanel&lt;/a&gt;和&lt;a href=&#34;https://github.com/NemesisRE/kiosk-mode&#34;&gt;HA的kiosk-mode插件&lt;/a&gt;，可以让这些设备直接成为HA的前端显示&lt;sup id=&#34;fnref:2&#34;&gt;&lt;a href=&#34;#fn:2&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;2&lt;/a&gt;&lt;/sup&gt;。&lt;/p&gt;
&lt;figure&gt;&lt;img src=&#34;http://localhost:1313/2023/02/10/silly-home-notes-1/panel.jpg&#34;
    alt=&#34;一个二手安卓触摸屏&#34;&gt;&lt;figcaption&gt;
      &lt;p&gt;一个二手安卓触摸屏&lt;/p&gt;
    &lt;/figcaption&gt;
&lt;/figure&gt;

&lt;p&gt;作为一个直男，还有一件事情要嘱咐：不要搞得太丑了，正常人不会喜欢满墙飞线的，至少拿个相框遮一下。这部分我也不会，所以我从网上找了一张图。&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;frame.webp&#34; alt=&#34;reddit：surface_pro_3_wall_tablet_install，这张图也挺丑的&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;esphome&#34;&gt;ESPHome&lt;/h3&gt;
&lt;p&gt;传感器是从遥控家居走向智能的关键一步，在需要更多种类的传感器时，&lt;a href=&#34;https://esphome.io/&#34;&gt;ESPHome&lt;/a&gt;能够派上用场。只需要一块ESP32，加上AHT20就是温湿度计，&lt;del&gt;加上SGP30是TVOC检测仪&lt;/del&gt;&lt;sup id=&#34;fnref:3&#34;&gt;&lt;a href=&#34;#fn:3&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;3&lt;/a&gt;&lt;/sup&gt;，加上PZEM-004T就是智能电流表，加上LD2410就是人体感应雷达，而且都可以与HA控制的所有设备联动。唯一的问题是，ESP32系列一般是通过Wifi联网，可能会对路由器造成一点点压力，如果是一万块钱的高级路由器K3就无所谓了。&lt;/p&gt;
&lt;p&gt;另外，如果完全不想和小米打交道，易微联、涂鸦或小燕科技的设备也可以试试。没准过几&lt;del&gt;天&lt;/del&gt;年Matter设备也会上市？&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;那么关于智能家居的第一部分在此告一段落，之后会记录一些&lt;a href=&#34;http://localhost:1313/2023/03/08/silly-home-notes-detailed/&#34;&gt;更为个性化的部分&lt;/a&gt;，而今天又是一个思念192.168.1.1的日子。虽然心已随着VPN回到家乡，但身体仍在公网上漂泊。&lt;/p&gt;
&lt;h2 id=&#34;参考&#34;&gt;参考&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://bbs.hassbian.com/thread-16261-1-1.html&#34;&gt;HA智能硬件采购避坑指要&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://post.m.smzdm.com/p/a85gplo7/?from=other&amp;amp;invite_code=zdm8xwesxhinv&amp;amp;send_by=6416413937&amp;amp;utm_source=pocket_mylist&amp;amp;zdm_ss=Android_6416413937_&#34;&gt;论如何打造一个科技爱好者/直男审美的家——（五）智能家居&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://zhuanlan.zhihu.com/p/87595668&#34;&gt;智能家居防悔全指南(小米/绿米)&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;footnotes&#34; role=&#34;doc-endnotes&#34;&gt;
&lt;hr&gt;
&lt;ol&gt;
&lt;li id=&#34;fn:1&#34;&gt;
&lt;p&gt;那么你可以直接跳过这篇文章，不会有什么损失。&amp;#160;&lt;a href=&#34;#fnref:1&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&#34;fn:2&#34;&gt;
&lt;p&gt;HA前端对浏览器版本有一定要求。如果设备过于古老的话，可能需要手动更新Webview，见&lt;a href=&#34;https://blakadder.com/android-panel-webview/&#34;&gt;此处&lt;/a&gt;。&amp;#160;&lt;a href=&#34;#fnref:2&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&#34;fn:3&#34;&gt;
&lt;p&gt;这个不要用，长期开机读数会暴涨。&amp;#160;&lt;a href=&#34;#fnref:3&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;
</description>
    </item>
    
  </channel>
</rss>